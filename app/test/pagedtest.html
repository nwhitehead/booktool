<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Test of PagedJS</title>
        <style>
            p {
                hyphens: manual;
                text-align: justify;
            }
            @page {
                size: 120mm 153mm;
                bleed: 6mm;
                marks: crop;
            }

        </style>
    </head>
    <body>
        <!-- <h1>Margin boxes of a page</h1>

        <p>A certain king had a beautiful garden.</p>

        <p>A page box consists of two types of area: page area and page mar&shy;gin
        boxes.</p> -->
        <div id="src">

            <p>The page area is the content area of a page box. It is the space into
            which all your HTML content will flow. When this content.</p>
            
            <p>The margins of a page are divided into sixteen boxes where you can
            put generated content like page number and running heads. These boxes
            are called margin.</p>
            
            <p>Each have its own margin, border, padding, and content areas. By
            default, their sizes are determined by the margin of the page box.</p>

            <p>Yeah.</p>
            
            <p>The figure bellow represent the sixteen margin boxes of a page
            defined by the W3C:</p>

            <p>This is final body text.</p>

            <p>The margins1 of a page are divided into sixteen boxes where you can
                put generated content like page number and running heads. These boxes
                are called margin.</p>

            <p>The margins2 of a page are divided into sixteen boxes where you can
                put generated content like page number and running heads. These boxes
                are called margin.</p>

            <p>The margins3 of a page are divided into sixteen boxes where you can
                put generated content like page number and running heads. These boxes
                are called margin.</p>
        
        </div>
    </body>
    <script>
        globalThis.PagedConfig = {
            auto: false,
        };
    </script>
    <script src="node_modules/pagedjs/dist/paged.polyfill.js"></script>
    <script src="node_modules/tex-linebreak2/dist/lib.js"></script>
    <script src="node_modules/hyphen/patterns/en-us.js"></script>
    <script src="node_modules/hyphen/hyphen.js"></script>
<script>
    function addHyphens() {
        const hyphenate = createHyphenator(hyphenationPatternsEnUs);
        const elems = document.querySelectorAll('p');
        for (const elem of elems) {
            elem.innerHTML = hyphenate(elem.innerHTML);
        }
    }

    function linebreak() {
        const { texLinebreakDOM } = globalThis.texLinebreak;
        texLinebreakDOM('#src', { justify: true, updateOnWindowResize: false });
    }

    function paginate() {
        globalThis.PagedPolyfill.preview();
    }

    function register() {
        class MyHandler extends Paged.Handler {
            constructor(chunker, polisher, caller) {
                super(chunker, polisher, caller);
            }

            // beforePageLayout(page) {
            //     const { texLinebreakDOM } = globalThis.texLinebreak;
            //     console.log(page.width);
            //     texLinebreakDOM(document.getElementById('src').querySelectorAll('p'), { justify: true, updateOnWindowResize: false });

            //     // const ps = node.querySelectorAll('p');
            //     // console.log(node.nodeName, node, ps[0]);
            //     // console.log(page, page.endToken);
            //     // if (node.nodeName === 'P') {
            //     //     console.log('layoutNode', node, node.offsetWidth, node.offsetHeight);
            //     //     texLinebreakDOM([node], { justify: true, stripSoftHyphensFromOutputText: false, updateOnWindowResize: false });
            //     // }
            // }
            layoutNode(node) {
                const { texLinebreakDOM } = globalThis.texLinebreak;
                if (node.nodeName === 'P') {
                    console.log('layoutNode', node);
                    texLinebreakDOM(node, { justify: true, stripSoftHyphensFromOutputText: false, updateOnWindowResize: false, lineWidth: 162.44 });
                }
        }
        }
        Paged.registerHandlers(MyHandler);
    }
</script>
    <button onclick="addHyphens()">Add hyphens</button>
    <button onclick="linebreak()">TeX linebreak</button>
    <button onclick="register()">Register handler</button>
    <button onclick="paginate()">Paginate</button>
</html>
